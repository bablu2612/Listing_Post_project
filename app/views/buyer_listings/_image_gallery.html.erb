
<section class="gallery hidden image_gallery_<%= id %>">
    <div class="container" style="display: none">
        <div class="image-gallery image-gallery_<%= id %>" style="display: none">
            <div class="row">
                <% images&.compact&.each do |image| %>
                    <div class="col-lg-3 col-md-6 col-sm-6 col-xs-12 image">
                        <div class="img-wrapper">
                            <a >
                                <img src="<%= url_for(image) %>" class="img-responsive">
                            </a>
                            <div class="img-overlay img-overlay_<%= id %>">
                                <i class="fa fa-plus-circle" aria-hidden="true"></i>
                            </div>
                        </div>
                    </div>
                <% end %>
            </div>
        </div>
    </div>
</section>

<script>
    // Gallery image hover
    $( ".img-wrapper" ).hover(
    function() {
        $(this).find(".img-overlay").animate({opacity: 1}, 600);
    }, function() {
        $(this).find(".img-overlay").animate({opacity: 0}, 600);
    }
    );

    // Lightbox
    var $overlay = $('<div class="overlay overlay_<%= id %>"></div>');
    var $image = $("<img class='images_of_<%=id%>'>");
    var $prevButton = $('<div class="prevButton prevButton_<%= id %>"><i class="fa fa-chevron-left"></i></div>');
    var $nextButton = $('<div class="nextButton nextButton_<%= id %>"><i class="fa fa-chevron-right"></i></div>');
    var $exitButton = $('<div class="exitButton exitButton_<%= id %>"><i class="fa fa-times"></i></div>');

    // Add overlay
    $overlay.append($image).prepend($prevButton).append($nextButton).append($exitButton);
    $(".image_gallery_<%= id %>").append($overlay);

    // Hide overlay on default
    $overlay.hide();

    // When an image is clicked
    $(".img-overlay_<%= id %>").click(function(event) {
        // Prevents default behavior
        event.preventDefault();
        // Adds href attribute to variable
        var imageLocation = $(this).prev().attr("href");
        // Add the image src to $image
        $image.attr("src", imageLocation);
        // Fade in the overlay
        $overlay.fadeIn("slow");
    });

    // When the overlay is clicked
    $overlay.click(function() {
    // Fade out the overlay
    $(this).fadeOut("slow");
    });

    // When next button is clicked
    $nextButton.click(function(event) {
    // Hide the current image
    $(".overlay_<%= id %> img").hide();
    // Overlay image location
    var $currentImgSrc = $(".overlay_<%= id %> img").attr("src");
    // Image with matching location of the overlay image
    var $currentImg = $('.image-gallery_<%= id %> img[src="' + $currentImgSrc + '"]');
    // Finds the next image
    var $nextImg = $($currentImg.closest(".image").next().find("img"));
    // All of the images in the gallery
    var $images = $(".image-gallery_<%= id %> img");
    // If there is a next image
    if ($nextImg.length > 0) { 
        // Fade in the next image
        $(".overlay_<%= id %> img").attr("src", $nextImg.attr("src")).fadeIn(800);
    } else {
        // Otherwise fade in the first image
        $(".overlay_<%= id %> img").attr("src", $($images[0]).attr("src")).fadeIn(800);
    }
    // Prevents overlay from being hidden
    event.stopPropagation();
    });

    // When previous button is clicked
    $prevButton.click(function(event) {
    // Hide the current image
    $(".overlay_<%= id %> img").hide();
    // Overlay image location
    var $currentImgSrc = $(".overlay_<%= id %> img").attr("src");
    // Image with matching location of the overlay image
    var $currentImg = $('.image-gallery_<%= id %> img[src="' + $currentImgSrc + '"]');
    // Finds the next image
    var $nextImg = $($currentImg.closest(".image").prev().find("img"));
    // Fade in the next image
    $(".overlay_<%= id %> img").attr("src", $nextImg.attr("src")).fadeIn(800);
    // Prevents overlay from being hidden
    event.stopPropagation();
    });

    // When the exit button is clicked
    $exitButton.click(function() {
    // Fade out the overlay
        $(".overlay_<%= id %>").fadeOut("slow");
    });
</script>