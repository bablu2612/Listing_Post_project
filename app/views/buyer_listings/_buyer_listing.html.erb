<div id="<%= dom_id buyer_listing %>" class="bg-white rounded-lg shadow p-6 mb-2 mt-5">
  <h2 class="text-2xl font-medium mb-6">Car Details</h2>
  
  <div class="grid grid-cols-2 gap-x-8 gap-y-4">
    <div>
      <p class="mb-4">
        <strong class="block text-gray-600 mb-1">Min Year:</strong>
        <%= buyer_listing.min_year %>
      </p>

      <p class="mb-4">
        <strong class="block text-gray-600 mb-1">Max Year:</strong>
        <%= buyer_listing.max_year %>
      </p>

      <p class="mb-4">
        <strong class="block text-gray-600 mb-1">Make:</strong>
        <%= buyer_listing.make %>
      </p>

      <p class="mb-4">
        <strong class="block text-gray-600 mb-1">Model:</strong>
        <%= buyer_listing.model %>
      </p>

      <p class="mb-4">
        <strong class="block text-gray-600 mb-1">Trim:</strong>
        <%= buyer_listing.trim %>
      </p>

      <p class="mb-4">
        <strong class="block text-gray-600 mb-1">Mileage:</strong>
        <%= buyer_listing.mileage %>
      </p>
    </div>

    <div>
      <p class="mb-4">
        <strong class="block text-gray-600 mb-1">Exterior color:</strong>
        <%= buyer_listing.exterior_color %>
      </p>

      <p class="mb-4">
        <strong class="block text-gray-600 mb-1">Interior color:</strong>
        <%= buyer_listing.interior_color %>
      </p>

      <p class="mb-4">
        <strong class="block text-gray-600 mb-1">Shipping Method:</strong>
        <%= buyer_listing.transportation %>
      </p>

      <p class="mb-4">
        <strong class="block text-gray-600 mb-1">Departure:</strong>
        <%= buyer_listing.departure %>
      </p>

      <p class="mb-4">
        <strong class="block text-gray-600 mb-1">Payment term:</strong>
        <%= buyer_listing.payment_term %>
      </p>

      <p class="mb-4">
        <strong class="block text-gray-600 mb-1">Min price:</strong>
        <%= buyer_listing.min_price %>
      </p>

       <p class="mb-4">
        <strong class="block text-gray-600 mb-1">Max price:</strong>
        <%= buyer_listing.max_price %>
      </p>

    </div>

    </div>
<% if current_user.role == "seller" %>
  <div class="car_attachement">
    <h2 class="text-2xl font-medium mb-[0] mt-5">Car Attachements</h2>
    <div class="car_attachment_button_main flex justify-end mb-[10px]">
      <button class="text-[#4e4a4a] edit_attachments "><%= @seller_listing&.files.present? ? "Edit" : "Add" %></button>
      <button class="text-[#4e4a4a] close_attachments hidden">Cancel</button>
    </div>
    <div class="seller_list_form edit_opened hidden">
      <form action="/sellers" method="post" enctype='multipart/form-data'>
        <input type="hidden" name="buyer_listing_id" value="<%= @buyer_listing.id %>">
        <div class="upload_files_main">
          <div class="max-w-xl">
            <label for="file_upload" id="drop_zone"
              class="flex justify-center w-full h-32 px-4 transition bg-white border-2 border-gray-300 border-dashed rounded-md appearance-none cursor-pointer hover:border-gray-400 focus:outline-none">
              <span class="flex items-center space-x-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-gray-600" fill="none" viewBox="0 0 24 24"
                  stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round"
                    d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                </svg>
                <span class="font-medium text-gray-600">
                  Drop files to Attach, or
                  <span class="text-blue-600 underline">browse</span>
                </span>
              </span>
              <input type="file" name="files[]" id="file_upload" class="hidden" multiple="true" accept="image/png, image/gif, image/jpeg">
            </label>
          </div>
          <div class="form_group mt-[15px] mb-[5px] flex  items-center gap-[20px]">
            <label for="offer_price" class="min-w-[95px]" >Offered Price</label>
            <input type="number" id="offer_price" name="offered_price" value="<%= @seller_listing&.offered_price %>" class="rounded">
          </div>

          <div class="submit_form mt-4">
            <button type="submit" class="w-full text-center no-underline relative items-center rounded-md bg-black px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">Submit</button>
          </div>
        </div>
      </form>
    </div>

    <% if @seller_listing&.files.present? %>
      <div class="flex attached_files_main mt-[10px] gap-[10px] edit_closed flex-wrap justify-center">
        <% @seller_listing&.files&.each do |image| %>
          <div class="w-[48%] " style="border: 1px solid #80808085;">    
            <img class="car_image" width="600" style="height: 110px; object-fit: cover" src="<%= url_for(image) %>">
          </div>
        <% end %>
      </div>
    <% else %>
      <div class="flex attached_files_main mt-[10px] gap-[10px] edit_closed flex-wrap justify-center mb-[15px] bg-[#80808047] text-[#000] rounded p-[30px] mt-[-8px]" style="border:1px dashed #80808073">
        No Attachements Found
      </div>
    <% end %>

    <div class="offered_class mt-2">
    <b>Offered Price:</b>  $<%= @seller_listing&.offered_price %>
    </div>

  </div>
<% end %>
</div>

<script>
    $(".edit_attachments").click(function(){
      $(".edit_opened").removeClass("hidden")
      $(".edit_closed").addClass("hidden")
      $(".edit_attachments").addClass("hidden")
       $(".close_attachments").removeClass("hidden")
    })

     $(".close_attachments").click(function(){
      $(".edit_closed").removeClass("hidden")
      $(".edit_opened").addClass("hidden")
      $(".close_attachments").addClass("hidden")
      $(".edit_attachments").removeClass("hidden")
    })
    // Get the drop zone element
    var dropZone = document.getElementById('drop_zone');

    // Get the file input element
    var fileInput = document.getElementById('file_upload');

    // Add event listeners for drag and drop
    dropZone.addEventListener('dragover', handleDragOver, false);
    dropZone.addEventListener('dragleave', handleDragLeave, false);
    dropZone.addEventListener('drop', handleDrop, false);

    // Add event listener for manual file selection
    fileInput.addEventListener('change', handleFileSelect, false);

    function handleDragOver(event) {
      event.preventDefault();
      dropZone.classList.add('border-blue-600');
    }

    function handleDragLeave(event) {
      event.preventDefault();
      dropZone.classList.remove('border-blue-600');
    }

    function handleDrop(event) {
      event.preventDefault();
      dropZone.classList.remove('border-blue-600');

      // Get the dropped files
      var files = event.dataTransfer.files;

      // Update the label text with the number of files dropped
      if (files.length === 1) {
        dropZone.querySelector('span').innerHTML = '1 file attached';
      } else {
        dropZone.querySelector('span').innerHTML = files.length + ' files attached';
      }

      // Add the files to the input element
      fileInput.files = files;
    }

    function handleFileSelect(event) {
      // Get the selected files
      var files = event.target.files;

      // Update the label text with the number of files selected
      if (files.length === 1) {
        dropZone.querySelector('span').innerHTML = '1 file attached';
      } else {
        dropZone.querySelector('span').innerHTML = files.length + ' files attached';
      }
    }
</script>

 

